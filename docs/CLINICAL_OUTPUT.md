# Clinical Output Layer â€” Documentation

## Overview

The Clinical Output Layer generates structured medical documentation from gesture interpretations, including SOAP notes and ICD-10 code suggestions.

**DISCLAIMER:** This is for demonstration purposes only. Real medical coding and documentation requires certified professionals.

## Components

- **clinicalOutput.ts** (`src/lib/clinicalOutput.ts`) - SOAP note and ICD-10 generation logic
- **DoctorOutput.tsx** (`src/components/DoctorOutput.tsx`) - Display component with expandable sections

## SOAP Note Generation

SOAP (Subjective, Objective, Assessment, Plan) notes are generated based on:
- Gesture tokens
- Body region indicated
- Emotion state (pain level, distress)
- Clinical interpretation

### Subjective

Auto-generated from:
- Body region indicated via gesture
- Pain indicators (fist gesture)
- Breathing indicators
- Emotional distress level
- Emergency signals

Example:
```
Patient indicates pain in the chest region via gesture. Patient appears 
to be in significant emotional distress (anxious).
```

### Objective

Includes:
- Communication method (gesture interpretation system)
- Gesture recognition confidence percentage
- Detected gestures
- Apparent pain level (scale 0-10)
- Emotional state

Example:
```
Communication via sign language/gesture interpretation system. 
Gesture recognition confidence: 90%. 
Detected gestures: point_chest, pain. 
Apparent pain level: 7/10. 
Emotional state: anxious.
```

### Assessment

Uses the clinical interpretation text generated by the medical reasoning layer.

### Plan

Generated based on:
- Body region (focused examination)
- Pain presence (assessment needed)
- Breathing issues (respiratory assessment)
- Emotional distress (support needed)
- Emergency status (immediate protocol)

Example:
```
1. Conduct focused physical examination of chest.
2. Obtain vital signs.
3. Assess pain characteristics (location, quality, duration, severity).
4. Continue gesture-based communication for symptom clarification.
```

## ICD-10 Code Suggestions

Reference codes are suggested based on gesture tokens. These are for demonstration only.

### Mappings

| Token | ICD-10 Codes |
|-------|--------------|
| `point_head` | R51.9 (Headache), G43.909 (Migraine) |
| `point_chest` | R07.9 (Chest pain), R07.89 (Other chest pain) |
| `breathing` | R06.00 (Dyspnea), R06.02 (Shortness of breath) |
| `point_abdomen` | R10.9 (Abdominal pain), R10.84 (Generalized pain) |
| `point_lower_right` | R10.31 (RLQ pain), K35.80 (Appendicitis) |
| `point_lower_left` | R10.32 (LLQ pain), K57.92 (Diverticulitis) |
| `pain` | R52 (Pain, unspecified) |
| `stroke` | I63.9 (Cerebral infarction), G45.9 (TIA) |

### Display

- Codes shown with full descriptions
- Limited to top 5 most relevant codes
- Includes disclaimer about certified coding

## User Interface

### Expandable Sections

The DoctorOutput component displays:

1. **Triage Badge** - Urgency level indicator
2. **Emotion Detection** - Pain level and distress
3. **Clinical Interpretation** - Main summary text
4. **SOAP Note** (expandable) - Full structured note
5. **ICD-10 Codes** (expandable) - Suggested codes with descriptions

### Features

- **Text-to-Speech** - "Read aloud" button uses Web Speech API
- **Animated Transitions** - Smooth expand/collapse animations
- **Code Highlighting** - ICD-10 codes displayed in monospace

## API

### `generateSOAPNote(gestureState, clinicalInterpretation, emotion)`

Returns a SOAP note object or null:

```typescript
interface SOAPNote {
  subjective: string;
  objective: string;
  assessment: string;
  plan: string;
}
```

### `getICD10Codes(gestureTokens)`

Returns an array of ICD-10 suggestions:

```typescript
interface ICD10Code {
  code: string;
  description: string;
}
```

### `generateClinicalOutput(gestureState, clinicalInterpretation)`

Returns complete clinical output:

```typescript
interface ClinicalOutput {
  summary: string;
  soapNote?: SOAPNote;
  icd10Codes?: string[];
  triageUrgency: TriageUrgency | null;
}
```

## Limitations

1. **Not for Clinical Use** - This is a demonstration system
2. **Rule-Based** - Uses simple token matching, not ML
3. **Limited Vocabulary** - Only common symptom presentations covered
4. **No Context** - Doesn't consider patient history or vitals
5. **Regulatory** - Would require FDA/CE certification for real use

## Future Enhancements

- Integration with MedGemma for LLM-based reasoning
- OpenAI GPT-4 for natural language understanding
- Real ICD-10 API integration
- EHR export functionality (FHIR)
- Multi-language support
